<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Spidev on LuyangのBlog</title>
    <link>/tags/spidev/</link>
    <description>Recent content in Spidev on LuyangのBlog</description>
    <generator>Hugo</generator>
    <language>en-US</language>
    <lastBuildDate>Mon, 26 Jun 2023 03:00:00 +0800</lastBuildDate>
    <atom:link href="/tags/spidev/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Android 7.1 build spidev_test.c</title>
      <link>/posts/android-7/</link>
      <pubDate>Mon, 26 Jun 2023 03:00:00 +0800</pubDate>
      <guid>/posts/android-7/</guid>
      <description>&lt;p&gt;下载一份 Linux 内核代码，拷贝一份 toos/spi/spidev_test.c 文件（只需要这一个文件）&lt;/p&gt;&#xA;&lt;p&gt;要在Android 7.1上编译&lt;code&gt;spidev_test.c&lt;/code&gt;，可以参考以下步骤：&lt;/p&gt;&#xA;&lt;h1 id=&#34;准备工作&#34;&gt;准备工作&lt;/h1&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;~~确保内核支持SPI设备&lt;/strong&gt;：~~&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;del&gt;在内核配置中启用SPI设备支持，确保&lt;code&gt;CONFIG_SPI&lt;/code&gt;和&lt;code&gt;CONFIG_SPI_SPIDEV&lt;/code&gt;选项被启用。&lt;/del&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;del&gt;修改设备树文件，添加SPI控制器和SPI设备节点。&lt;/del&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;strong&gt;创建Android.mk文件&lt;/strong&gt;：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;在&lt;code&gt;system/extras&lt;/code&gt;目录下创建一个名为&lt;code&gt;spi&lt;/code&gt;的文件夹。&lt;/li&gt;&#xA;&lt;li&gt;将&lt;code&gt;spidev_test.c&lt;/code&gt;文件复制到&lt;code&gt;spi&lt;/code&gt;文件夹中。&lt;/li&gt;&#xA;&lt;li&gt;在&lt;code&gt;spi&lt;/code&gt;文件夹中创建一个&lt;code&gt;Android.mk&lt;/code&gt;文件，内容如下：&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-makefile&#34; data-lang=&#34;makefile&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LOCAL_PATH &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;call my-dir&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;CLEAR_VARS&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LOCAL_MODULE &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; spidev_test&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LOCAL_SRC_FILES &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; spidev_test.c&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LOCAL_MODULE_TAGS &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; optional&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;BUILD_EXECUTABLE&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h1 id=&#34;编译步骤&#34;&gt;编译步骤&lt;/h1&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;编译&lt;code&gt;spidev_test&lt;/code&gt;&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;打开终端，切换到&lt;code&gt;spi&lt;/code&gt;目录。&lt;/li&gt;&#xA;&lt;li&gt;执行&lt;code&gt;mm&lt;/code&gt;命令进行编译。这将在&lt;code&gt;out/target/product/&amp;lt;your_device&amp;gt;/symbols/system&lt;/code&gt;目录下生成可执行文件&lt;code&gt;spidev_test&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;将可执行文件推送到设备&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;使用&lt;code&gt;adb push&lt;/code&gt;命令将&lt;code&gt;spidev_test&lt;/code&gt;推送到设备上的某个目录，例如：&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;adb push out/target/product/&amp;lt;your_device&amp;gt;/symbols/system/spidev_test /data/&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;在设备上运行测试程序&lt;/strong&gt;：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;使用&lt;code&gt;adb shell&lt;/code&gt;连接到设备，切换到包含&lt;code&gt;spidev_test&lt;/code&gt;的目录，并运行程序：&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;adb shell&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd /data/&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;chmod &lt;span style=&#34;color:#ae81ff&#34;&gt;777&lt;/span&gt; spidev_test&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./spidev_test&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;注意事项&#34;&gt;注意事项&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;确保设备上已经正确配置了SPI设备节点，例如&lt;code&gt;/dev/spidevX.Y&lt;/code&gt;，其中&lt;code&gt;X&lt;/code&gt;是SPI控制器编号，&lt;code&gt;Y&lt;/code&gt;是设备编号。&lt;/li&gt;&#xA;&lt;li&gt;如果在编译或运行过程中遇到问题，检查内核配置和设备树文件是否正确设置，并确保所有必要的权限和依赖项都已满足。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h1 id=&#34;adb-指定被操作设备&#34;&gt;adb 指定被操作设备&lt;/h1&gt;&#xA;&lt;p&gt;如果 PC 当前连接了多个正在运行 adb 的设备，可以通过 &lt;code&gt;adb -s&lt;/code&gt; 指定操作特定设备&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;gt;adb devices&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;List of devices attached&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;J6-9f81e1412b08443 device&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;EE02FL9SR5 device&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;adb -s &amp;lt;序列号&amp;gt; shell&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
  </channel>
</rss>
