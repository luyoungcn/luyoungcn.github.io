<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>è™šæ‹Ÿçº¿ç¨‹ on Luyangã®Blog</title>
    <link>/tags/%E8%99%9A%E6%8B%9F%E7%BA%BF%E7%A8%8B/</link>
    <description>Recent content in è™šæ‹Ÿçº¿ç¨‹ on Luyangã®Blog</description>
    <generator>Hugo</generator>
    <language>en-US</language>
    <lastBuildDate>Tue, 24 Jun 2025 02:30:00 +0800</lastBuildDate>
    <atom:link href="/tags/%E8%99%9A%E6%8B%9F%E7%BA%BF%E7%A8%8B/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>ğŸ“˜æ·±å…¥è§£æ Java çº¿ç¨‹æœ¬åœ°åŒ–ï¼šä» ThreadLocal åˆ° ScopedValue çš„æ¼”è¿›ä¸é€‰æ‹©</title>
      <link>/posts/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-java-%E7%BA%BF%E7%A8%8B%E6%9C%AC%E5%9C%B0%E5%8C%96%E4%BB%8E-threadlocal-%E5%88%B0-scopedvalue-%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B8%8E%E9%80%89%E6%8B%A9/</link>
      <pubDate>Tue, 24 Jun 2025 02:30:00 +0800</pubDate>
      <guid>/posts/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-java-%E7%BA%BF%E7%A8%8B%E6%9C%AC%E5%9C%B0%E5%8C%96%E4%BB%8E-threadlocal-%E5%88%B0-scopedvalue-%E7%9A%84%E6%BC%94%E8%BF%9B%E4%B8%8E%E9%80%89%E6%8B%A9/</guid>
      <description>&lt;blockquote&gt;&#xA;&lt;p&gt;The beauty of open source is that it is technically borderless. &amp;mdash; &lt;a href=&#34;https://www.reddit.com/user/AlterTableUsernames/&#34;&gt;u/AlterTableUsernames&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;h2 id=&#34;æ·±å…¥è§£æ-java-çº¿ç¨‹æœ¬åœ°åŒ–ä»-threadlocal-åˆ°-scopedvalue-çš„æ¼”è¿›ä¸é€‰æ‹©&#34;&gt;æ·±å…¥è§£æ Java çº¿ç¨‹æœ¬åœ°åŒ–ï¼šä» ThreadLocal åˆ° ScopedValue çš„æ¼”è¿›ä¸é€‰æ‹©&lt;/h2&gt;&#xA;&lt;h3 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦&lt;/h3&gt;&#xA;&lt;p&gt;åœ¨ Java æœåŠ¡ç«¯å¼€å‘ä¸­ï¼Œå°†è´¯ç©¿å•æ¬¡ä¸šåŠ¡æµç¨‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·èº«ä»½ã€åˆ†å¸ƒå¼è¿½è¸ªIDï¼‰åœ¨çº¿ç¨‹å†…éƒ¨è¿›è¡Œä¼ é€’ï¼Œæ˜¯ä¸€é¡¹åŸºç¡€ä¸”å…³é”®çš„éœ€æ±‚ã€‚ä¸ºåº”å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼ŒJava æä¾›äº†ç»å…¸çš„ &lt;code&gt;ThreadLocal&lt;/code&gt; æœºåˆ¶ï¼Œå®ƒé€šè¿‡å·§å¦™åœ°å°†æ•°æ®ä¸æ‰§è¡Œçº¿ç¨‹ç»‘å®šï¼Œå®ç°äº†é«˜æ•ˆçš„æ— é”åŒ–æ•°æ®éš”ç¦»ã€‚ç„¶è€Œï¼Œè¿™ä¸€ç»å…¸æ–¹æ¡ˆå¦‚åŒä¸€æŠŠåŒåˆƒå‰‘ï¼šå…¶ç²¾å·§çš„è®¾è®¡èƒŒåï¼Œæ˜¯å……æ»¡é™·é˜±çš„æ— ç•Œç”Ÿå‘½å‘¨æœŸã€éš¾ä»¥è¿½è¸ªçš„å¯å˜æ€§ï¼Œä»¥åŠåœ¨ç°ä»£çº¿ç¨‹æ± æ¨¡å‹ä¸‹ææ˜“è§¦å‘çš„å†…å­˜æ³„æ¼é£é™©ã€‚&lt;/p&gt;&#xA;&lt;p&gt;éšç€ Project Loom è®¡åˆ’çš„æˆç†Ÿï¼ŒJava å¹¶å‘ç¼–ç¨‹æ­£ç»å†ä¸€åœºæ·±åˆ»çš„èŒƒå¼é©å‘½ã€‚è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰çš„å¼•å…¥ï¼Œä½¿å¾— &lt;code&gt;InheritableThreadLocal&lt;/code&gt; çš„ç»§æ‰¿æˆæœ¬å˜å¾—ä¸å¯æ¥å—ï¼›è€Œç»“æ„åŒ–å¹¶å‘ï¼ˆStructured Concurrencyï¼‰çš„æå‡ºï¼Œåˆ™å‘¼å”¤ä¸€ç§æ›´å®‰å…¨ã€æ›´å…·ç¡®å®šæ€§çš„ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶ã€‚åœ¨æ­¤èƒŒæ™¯ä¸‹ï¼Œ&lt;code&gt;ScopedValue&lt;/code&gt; åº”è¿è€Œç”Ÿã€‚å®ƒå¹¶é &lt;code&gt;ThreadLocal&lt;/code&gt; çš„ç®€å•æ”¹è‰¯ï¼Œè€Œæ˜¯ä»è®¾è®¡å“²å­¦ä¸Šå¯¹çº¿ç¨‹æœ¬åœ°æ•°æ®çš„ä¸€æ¬¡é‡å¡‘ï¼Œç”¨â€œåŠ¨æ€ä½œç”¨åŸŸâ€çš„ä¸å¯å˜ç»‘å®šï¼Œå–ä»£äº†â€œçº¿ç¨‹å¯„ç”Ÿâ€çš„å¯å˜çŠ¶æ€ã€‚&lt;/p&gt;&#xA;&lt;p&gt;æœ¬æ–‡å°†å¯¹ Java çš„çº¿ç¨‹æœ¬åœ°åŒ–æŠ€æœ¯è¿›è¡Œä¸€æ¬¡ä»ç»å…¸åˆ°ç°ä»£çš„å®Œæ•´ã€æ·±å…¥çš„æ¢ç´¢ã€‚æˆ‘ä»¬å°†é¦–å…ˆè§£æ„ &lt;code&gt;ThreadLocal&lt;/code&gt; çš„å†…éƒ¨æ¶æ„ï¼Œè¯¦å°½å‰–æå…¶ &lt;code&gt;Thread-ThreadLocalMap-ThreadLocal&lt;/code&gt; çš„å§”æ‰˜å…³ç³»æ¨¡å‹ï¼Œå¹¶å¯¹å…¶â€œå¼±å¼•ç”¨Key-å¼ºå¼•ç”¨Valueâ€ç­‰å…³é”®è®¾è®¡å†³ç­–èƒŒåçš„æ·±å±‚æ€è¾¨è¿›è¡Œè®ºè¯ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†èšç„¦äº &lt;code&gt;InheritableThreadLocal&lt;/code&gt; åœ¨çº¿ç¨‹æ± å’Œè™šæ‹Ÿçº¿ç¨‹æ—¶ä»£ä¸‹çš„å›°å¢ƒä¸å®¿æ€¨ã€‚éšåï¼Œæ–‡ç« å°†å…¨é¢è½¬å‘ &lt;code&gt;ScopedValue&lt;/code&gt;ï¼Œå°†å…¶ä½œä¸ºé¢å‘æœªæ¥çš„è§£å†³æ–¹æ¡ˆï¼Œé‡ç‚¹é˜è¿°å…¶ä¸ç»“æ„åŒ–å¹¶å‘å¦‚ä½•å¤©ä½œä¹‹åˆèˆ¬åœ°è§£å†³äº†æ•°æ®è‡ªåŠ¨ã€å®‰å…¨ã€é«˜æ•ˆä¼ æ’­çš„æ ¸å¿ƒéš¾é¢˜ã€‚æœ€åï¼Œæœ¬æ–‡é€šè¿‡ä¸€åœºæ¶‰åŠæ­£ç¡®æ€§ã€æ€§èƒ½ä¸å¿ƒæ™ºæ¨¡å‹çš„å…¨æ–¹ä½å¯¹å†³ï¼Œä¸ºå¼€å‘è€…åœ¨æŠ€æœ¯æ¼”è¿›çš„æµªæ½®ä¸­åšå‡ºæ˜æ™ºé€‰æ‹©æä¾›åšå®çš„ç†è®ºä¾æ®ã€‚&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;h3 id=&#34;ç¬¬ä¸€ç« -threadlocal---ä¸€ä¸ªè®¾è®¡ç²¾å·§è€Œåˆå……æ»¡é™·é˜±çš„ç»å…¸&#34;&gt;ç¬¬ä¸€ç« : &lt;code&gt;ThreadLocal&lt;/code&gt; - ä¸€ä¸ªè®¾è®¡ç²¾å·§è€Œåˆå……æ»¡é™·é˜±çš„ç»å…¸&lt;/h3&gt;&#xA;&lt;p&gt;&lt;code&gt;ThreadLocal&lt;/code&gt; çš„æ ¸å¿ƒä½¿å‘½æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä¸ªä¸“å±çš„æ•°æ®å­˜å‚¨ç©ºé—´ï¼Œä»è€Œå®ç°çº¿ç¨‹çº§åˆ«çš„æ•°æ®éš”ç¦»ã€‚å®ƒè®©å¼€å‘è€…æ„Ÿè§‰å¥½åƒåœ¨ä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„å…¨å±€å˜é‡ï¼Œä½†å®é™…ä¸Šæ¯ä¸ªçº¿ç¨‹æ“ä½œçš„éƒ½æ˜¯è‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ã€‚&lt;/p&gt;&#xA;&lt;h4 id=&#34;11-æ ¸å¿ƒæ¶æ„å§”æ‰˜ä¸å¯„ç”Ÿçš„è‰ºæœ¯&#34;&gt;1.1 æ ¸å¿ƒæ¶æ„ï¼šå§”æ‰˜ä¸å¯„ç”Ÿçš„è‰ºæœ¯&lt;/h4&gt;&#xA;&lt;p&gt;è¦ç†è§£ &lt;code&gt;ThreadLocal&lt;/code&gt;ï¼Œé¦–å…ˆå¿…é¡»ç ´é™¤ä¸€ä¸ªè¯¯è§£ï¼šæ•°æ®å¹¶éå­˜å‚¨åœ¨ &lt;code&gt;ThreadLocal&lt;/code&gt; å¯¹è±¡æœ¬èº«ã€‚&lt;code&gt;ThreadLocal&lt;/code&gt; å®ä¾‹æ‰®æ¼”çš„æ˜¯ä¸€ä¸ªâ€œè®¿é—®å·¥å…·â€æˆ–â€œä»£ç†â€çš„è§’è‰²ï¼ŒçœŸæ­£çš„å­˜å‚¨å‘ç”Ÿåœ¨æ‰§è¡Œçº¿ç¨‹ &lt;code&gt;Thread&lt;/code&gt; å¯¹è±¡çš„å†…éƒ¨ã€‚è¿™ç§å…³ç³»å¯ä»¥è¢«ç†è§£ä¸ºä¸€ç§å·§å¦™çš„â€œå§”æ‰˜â€æˆ–â€œå¯„ç”Ÿâ€æ¨¡å‹ã€‚&lt;/p&gt;&#xA;&lt;p&gt;å®ƒä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;&lt;code&gt;Thread&lt;/code&gt; å¯¹è±¡&lt;/strong&gt;: çº¿ç¨‹çš„å®ä½“ã€‚æ¯ä¸ª &lt;code&gt;Thread&lt;/code&gt; å®ä¾‹å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª &lt;code&gt;ThreadLocal.ThreadLocalMap&lt;/code&gt; ç±»å‹çš„æˆå‘˜å˜é‡ &lt;code&gt;threadLocals&lt;/code&gt;ã€‚è¿™ä¸ª Map æ˜¯æƒ°æ€§åˆ›å»ºçš„ï¼Œåªåœ¨çº¿ç¨‹é¦–æ¬¡éœ€è¦å­˜å‚¨ &lt;code&gt;ThreadLocal&lt;/code&gt; æ•°æ®æ—¶æ‰è¢«å®ä¾‹åŒ–ã€‚&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;&lt;code&gt;ThreadLocalMap&lt;/code&gt;&lt;/strong&gt;: &lt;code&gt;ThreadLocal&lt;/code&gt; çš„ä¸€ä¸ªå†…éƒ¨é™æ€ç±»ï¼Œæ˜¯ä¸€ä¸ªä¸º &lt;code&gt;ThreadLocal&lt;/code&gt; é‡èº«å®šåˆ¶çš„ã€éé€šç”¨çš„å“ˆå¸Œè¡¨ã€‚å®ƒæ‰æ˜¯çœŸæ­£å­˜å‚¨æ•°æ®çš„å®¹å™¨ï¼Œå…¶æ‰€æœ‰æƒå®Œå…¨å½’å±äº &lt;code&gt;Thread&lt;/code&gt; å¯¹è±¡ã€‚&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;&lt;code&gt;ThreadLocal&lt;/code&gt; å¯¹è±¡&lt;/strong&gt;: å®ƒåœ¨æ•´ä¸ªä½“ç³»ä¸­æ˜¯â€œå®šä½é”®â€å’Œâ€œè®¿é—®å…¥å£â€ã€‚ä½ çš„ä»£ç é€šè¿‡è°ƒç”¨ &lt;code&gt;ThreadLocal&lt;/code&gt; å®ä¾‹çš„ &lt;code&gt;set()&lt;/code&gt; æˆ– &lt;code&gt;get()&lt;/code&gt; æ–¹æ³•æ¥æ“ä½œæ•°æ®ã€‚&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;ç”¨æˆ·æ•°æ® (e.g., &lt;code&gt;RequestData&lt;/code&gt;)&lt;/strong&gt;: æœŸæœ›åœ¨çº¿ç¨‹å†…å…±äº«çš„ä¸šåŠ¡æ•°æ®ï¼Œä½œä¸ºâ€œå€¼â€è¢«å­˜å‚¨ã€‚&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;ä¸€æ¬¡ &lt;code&gt;set&lt;/code&gt; æ“ä½œçš„å®Œæ•´è½¨è¿¹&lt;/strong&gt;:&#xA;å½“ &lt;code&gt;CONTEXT.set(data)&lt;/code&gt; è¢«è°ƒç”¨æ—¶ï¼š&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
