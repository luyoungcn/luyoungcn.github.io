<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Wsl on LuyangのBlog</title>
    <link>/tags/wsl/</link>
    <description>Recent content in Wsl on LuyangのBlog</description>
    <generator>Hugo</generator>
    <language>en-US</language>
    <lastBuildDate>Thu, 26 Oct 2023 00:00:00 +0800</lastBuildDate>
    <atom:link href="/tags/wsl/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Windows WSL ubuntu adb 配置</title>
      <link>/posts/windows_wsl_ubuntu_adb_%E9%85%8D%E7%BD%AE/</link>
      <pubDate>Thu, 26 Oct 2023 00:00:00 +0800</pubDate>
      <guid>/posts/windows_wsl_ubuntu_adb_%E9%85%8D%E7%BD%AE/</guid>
      <description>&lt;h2 id=&#34;配置前的状态&#34;&gt;配置前的状态&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;windows 11 + wsl + ubuntu 18.04&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;windows 可以识别 adb devices&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;C:\Users&amp;gt;adb devices&#xA;List of devices attached&#xA;fada-018b4209f24d0001   device&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;wsl 识别不到 adb devices&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;luyang@LUYANG:~$ adb devices&#xA;* daemon not running; starting now at tcp:5037&#xA;* daemon started successfully&#xA;List of devices attached&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;windows-安装工具包&#34;&gt;Windows 安装工具包&lt;/h2&gt;&#xA;&lt;p&gt;windows 安装 &lt;a href=&#34;https://github.com/dorssel/usbipd-win/releases&#34;&gt;usbipd-win&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;wsl-安装工具包&#34;&gt;WSL 安装工具包&lt;/h2&gt;&#xA;&lt;p&gt;WSL ubuntu 安装 adb 工具&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install android-tools-adb&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在WSL中，安装 USB/IP 的用户空间工具和 USB 硬件标识符的数据库。&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install linux-tools-5.15.0-87-generic hwdata&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# 注意 linux-tools 相应的要改成你实际安装的版本&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo update-alternatives --install /usr/local/bin/usbip usbip /usr/lib/linux-tools/5.15.0-87-generic/usbip &lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;关于-linux-tools&#34;&gt;关于 linux-tools&lt;/h3&gt;&#xA;&lt;p&gt;查看当前 ubuntu 系统版本支持的 linux-tools generic版本&lt;/p&gt;</description>
    </item>
    <item>
      <title>windows10 WSL setup</title>
      <link>/posts/windows10_wsl/</link>
      <pubDate>Thu, 09 Feb 2023 00:00:00 +0800</pubDate>
      <guid>/posts/windows10_wsl/</guid>
      <description>&lt;h2 id=&#34;wsl-安装系统&#34;&gt;WSL 安装系统&lt;/h2&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;推荐 Ubuntu-22.04 Ubuntu 22.04 LTS&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wsl.exe --install --d Ubuntu-22.04&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;wsl-卸载系统&#34;&gt;WSL 卸载系统&lt;/h2&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wsl -l -v&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wsl --unregister Debian&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;wsl-kernel-客制化&#34;&gt;WSL kernel 客制化&lt;/h2&gt;&#xA;&lt;p&gt;首先运行 wsl 通过如下命令确认当前内核版本：&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;uname -a&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Linux x 6.6.87.2-microsoft-standard-WSL2+ &lt;span style=&#34;color:#75715e&#34;&gt;#1 SMP PREEMPT_DYNAMIC Sun Jun 15 21:13:48 CST 2025 x86_64 x86_64 x86_64 GNU/Linux&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;克隆源代码&#34;&gt;克隆源代码&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://github.com/microsoft/WSL2-Linux-Kernel.git --depth&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; -b linux-msft-wsl-6.6.y&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cd WSL2-Linux-Kernel&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git tag -l | grep &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;6.6.87&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git checkout -b my-6.6.87.2-kernel linux-msft-wsl-6.6.87.2&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;--depth=1&lt;/code&gt; clones only the latest commit to save time and space.&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;-b linux-msft-wsl-6.6.y&lt;/code&gt; specifies the branch to clone.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;目前 github &lt;a href=&#34;https://github.com/microsoft/WSL2-Linux-Kernel&#34;&gt;https://github.com/microsoft/WSL2-Linux-Kernel&lt;/a&gt; 主要版本：&lt;/p&gt;</description>
    </item>
    <item>
      <title>windows WSL 端口映射</title>
      <link>/posts/windows_wsl_%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84/</link>
      <pubDate>Thu, 01 Jan 1970 00:00:00 +0800</pubDate>
      <guid>/posts/windows_wsl_%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84/</guid>
      <description>&lt;p&gt;实际应用中需要将嵌入式开发板的数据通过网络发送出去，如果 WSL 中运行的 client 要与嵌入式开发板进行通讯，则需要将 windows 的端口转发到 WSL 中，反之，如果配置了 windows 端口转发到 WSL 中，则 windows client 无法正常接收开发板的数据，这一点需要注意，需要取消端口转发 windows 端才可以正常接收数据。&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;From: &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/wsl/networking&#34;&gt;https://learn.microsoft.com/en-us/windows/wsl/networking&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;Here&amp;rsquo;s an example of using the &lt;a href=&#34;https://learn.microsoft.com/en-us/windows-server/networking/technologies/netsh/netsh-interface-portproxy&#34;&gt;Netsh interface portproxy&lt;/a&gt; Windows command to add a port proxy that listens on your host port and connects that port proxy to the IP address for the WSL 2 VM.&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;netsh interface portproxy add v4tov4 listenport=&amp;lt;yourPortToForward&amp;gt; listenaddress=&lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;.0.0 connectport=&amp;lt;yourPortToConnectToInWSL&amp;gt; connectaddress=(wsl hostname -I)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this example, you will need to update &lt;code&gt;&amp;lt;yourPortToForward&amp;gt;&lt;/code&gt; to a port number, for example &lt;code&gt;listenport=4000&lt;/code&gt;. &lt;code&gt;listenaddress=0.0.0.0&lt;/code&gt; means that incoming requests will be accepted from ANY IP address. The Listen Address specifies the IPv4 address for which to listen and can be changed to values that include: IP address, computer NetBIOS name, or computer DNS name. If an address isn&amp;rsquo;t specified, the default is the local computer. You need to update the &lt;code&gt;&amp;lt;yourPortToConnectToInWSL&amp;gt;&lt;/code&gt; value to a port number where you want WSL to connect, for example &lt;code&gt;connectport=4000&lt;/code&gt;. Lastly, the &lt;code&gt;connectaddress&lt;/code&gt; value needs to be the IP address of your Linux distribution installed via WSL 2 (the WSL 2 VM address), which can be found by entering the command: &lt;code&gt;wsl.exe hostname -I&lt;/code&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>wsl 使用 usbipd 访问 USB 设备</title>
      <link>/posts/usbipd/</link>
      <pubDate>Thu, 01 Jan 1970 00:00:00 +0800</pubDate>
      <guid>/posts/usbipd/</guid>
      <description>&lt;blockquote&gt;&#xA;&lt;p&gt;注意：如下 usbipd 命令需要在 &lt;code&gt;以管理员身份运行&lt;/code&gt; 的 powershell 中执行&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;usbipd: USB/IP open-source project&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PS C:&lt;span style=&#34;color:#ae81ff&#34;&gt;\W&lt;/span&gt;INDOWS&lt;span style=&#34;color:#ae81ff&#34;&gt;\s&lt;/span&gt;ystem32&amp;gt; usbipd wsl attach --busid 4-4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;usbipd: error: The service is currently not running; a reboot should fix that.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/dorssel/usbipd-win/issues/122&#34;&gt;https://github.com/dorssel/usbipd-win/issues/122&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;参考了上述链接，也做了重启，仍然报错，于是决定升级 &lt;code&gt;usbipd&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;如下步骤也可以作为如何安装 usbipd，wsl 通过 usbipd 访问 USB 设备&lt;/p&gt;&#xA;&lt;h2 id=&#34;usbipd-安装使用&#34;&gt;usbipd 安装使用&lt;/h2&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/dorssel/usbipd-win/releases/tag/v4.0.0&#34;&gt;https://github.com/dorssel/usbipd-win/releases/tag/v4.0.0&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;下载 &lt;a href=&#34;https://github.com/dorssel/usbipd-win/releases/download/v4.0.0/usbipd-win_4.0.0.msi&#34;&gt;usbipd-win_4.0.0.msi&lt;/a&gt; 并安装&lt;/p&gt;&#xA;&lt;p&gt;需要注意的是，安装了这个版本发现 usbipd 命令的使用方式变了&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PS C:&lt;span style=&#34;color:#ae81ff&#34;&gt;\W&lt;/span&gt;INDOWS&lt;span style=&#34;color:#ae81ff&#34;&gt;\s&lt;/span&gt;ystem32&amp;gt; usbipd.exe wsl list&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;usbipd: error: The &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;wsl&amp;#39;&lt;/span&gt; subcommand has been removed. Learn about the new syntax at https://learn.microsoft.com/windows/wsl/connect-usb#attach-a-usb-device.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PS C:&lt;span style=&#34;color:#ae81ff&#34;&gt;\W&lt;/span&gt;INDOWS&lt;span style=&#34;color:#ae81ff&#34;&gt;\s&lt;/span&gt;ystem32&amp;gt; usbipd attach --busid 4-4&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Option &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;--wsl&amp;#39;&lt;/span&gt; is required.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;usbipd-win 4.0.0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Description:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Attaches a USB device to a client.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Currently, only WSL is supported. Other clients need to perform an attach using client-side tooling.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Exactly one of the options &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;--busid&amp;#39;&lt;/span&gt; or &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;--hardware-id&amp;#39;&lt;/span&gt; is required.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Usage:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  usbipd attach &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;options&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Options:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -a, --auto-attach                      Automatically re-attach when the device is detached or unplugged&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -b, --busid &amp;lt;BUSID&amp;gt;                    Attach device having &amp;lt;BUSID&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -i, --hardware-id &amp;lt;VID:PID&amp;gt;            Attach device having &amp;lt;VID&amp;gt;:&amp;lt;PID&amp;gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -w, --wsl &amp;lt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;DISTRIBUTION&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;&amp;gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;REQUIRED&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;  Attach to WSL, optionally specifying the distribution to use&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -?, -h, --help                         Show help and usage information&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/MicrosoftDocs/WSL/issues/1868&#34;&gt;https://github.com/MicrosoftDocs/WSL/issues/1868&lt;/a&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
