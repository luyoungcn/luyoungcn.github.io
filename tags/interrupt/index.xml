<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Interrupt on LuyangのBlog</title>
    <link>/tags/interrupt/</link>
    <description>Recent content in Interrupt on LuyangのBlog</description>
    <generator>Hugo</generator>
    <language>en-US</language>
    <lastBuildDate>Thu, 01 Jan 1970 00:00:00 +0800</lastBuildDate>
    <atom:link href="/tags/interrupt/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>如何在 Linux 用户空间中进行类似 GPIO 中断的处理</title>
      <link>/posts/how_to_handle_gpio_interrupt_like_handling_in_linux_userspace/</link>
      <pubDate>Thu, 01 Jan 1970 00:00:00 +0800</pubDate>
      <guid>/posts/how_to_handle_gpio_interrupt_like_handling_in_linux_userspace/</guid>
      <description>&lt;h1 id=&#34;how-to-handle-gpio-interrupt-like-handling-in-linux-userspace&#34;&gt;How to handle GPIO interrupt-like handling in Linux userspace&lt;/h1&gt;&#xA;&lt;h2 id=&#34;文件节点&#34;&gt;文件节点&lt;/h2&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/sys/class/gpio/gpio666# ls&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;active_low  device  direction  edge  subsystem  uevent  value&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;只用对应 GPIO 有 irq 功能时才会有 edge 文件。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;/sys/class/gpio/export：是一个只写文件，用于导出需要使用的 GPIO 引脚&lt;/li&gt;&#xA;&lt;li&gt;/sys/class/gpio/gpiox/: 是一个文件夹，在引脚导出后自动在 / sys/class/gpio / 目录下生成的&lt;/li&gt;&#xA;&lt;li&gt;/sys/class/gpio/gpiox/active_low：是一个文件，用来控制电平的极性（写 1 是高电平还是写 0 是高电平），默认写 1 是高电平，这个文件不用去管它&lt;/li&gt;&#xA;&lt;li&gt;/sys/class/gpio/gpiox/direction：是一个文件，用来控制 GPIO 是输入还是输出，往direction写 out 就是输出引脚，往direction写 in 就是输入引脚&lt;/li&gt;&#xA;&lt;li&gt;/sys/class/gpio/gpiox/edge：是一个文件，在输入模式下，写 edge 文件，配置 gpio 为外部中断引脚&lt;/li&gt;&#xA;&lt;li&gt;非中断引脚： none&lt;/li&gt;&#xA;&lt;li&gt;上升沿触发： rising&lt;/li&gt;&#xA;&lt;li&gt;下降沿触发： falling&lt;/li&gt;&#xA;&lt;li&gt;边沿触发： both&lt;/li&gt;&#xA;&lt;li&gt;/sys/class/gpio/gpiox/value: 是一个文件，在输出模式下，写该文件表示 gpio 输出；在输入模式下读该文件表示输入&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.kernel.org/doc/Documentation/gpio/sysfs.txt&#34;&gt;sysfs.txt&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-txt&#34; data-lang=&#34;txt&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;#34;value&amp;#34; ... reads as either 0 (low) or 1 (high). If the GPIO&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  is configured as an output, this value may be written;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  any nonzero value is treated as high.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  If the pin can be configured as interrupt-generating interrupt&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  and if it has been configured to generate interrupts (see the&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  description of &amp;#34;edge&amp;#34;), you can poll(2) on that file and&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  poll(2) will return whenever the interrupt was triggered. If&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  you use poll(2), set the events POLLPRI and POLLERR. If you&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  use select(2), set the file descriptor in exceptfds. After&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  poll(2) returns, either lseek(2) to the beginning of the sysfs&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  file and read the new value or close the file and re-open it&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  to read the value.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;#34;edge&amp;#34; ... reads as either &amp;#34;none&amp;#34;, &amp;#34;rising&amp;#34;, &amp;#34;falling&amp;#34;, or&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;#34;both&amp;#34;. Write these strings to select the signal edge(s)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  that will make poll(2) on the &amp;#34;value&amp;#34; file return.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  This file exists only if the pin can be configured as an&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  interrupt generating input pin.&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;demo&#34;&gt;demo&lt;/h2&gt;&#xA;&lt;p&gt;一坨屎样代码&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
